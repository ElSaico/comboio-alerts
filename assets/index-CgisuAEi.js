var Es=Object.defineProperty;var Ts=(t,e,s)=>e in t?Es(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var b=(t,e,s)=>Ts(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const Ss=!1;var Le=Array.isArray,Qt=Array.from,Ps=Object.defineProperty,me=Object.getOwnPropertyDescriptor,bs=Object.getOwnPropertyDescriptors,_e=Object.getPrototypeOf;const X=()=>{};function qe(t){for(var e=0;e<t.length;e++)t[e]()}const W=2,We=4,yt=8,te=16,D=32,Nt=64,j=128,Vt=256,P=512,G=1024,pt=2048,q=4096,Bt=8192,As=16384,ze=32768,ks=1<<18,Xe=1<<19,Os=Symbol("$state"),Vs=Symbol("");function Ke(t){return t===this.v}function Ge(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Fs(t){return!Ge(t,this.v)}function Ms(t){throw new Error("effect_in_teardown")}function Ds(){throw new Error("effect_in_unowned_derived")}function Ns(t){throw new Error("effect_orphan")}function Hs(){throw new Error("effect_update_depth_exceeded")}function Ls(){throw new Error("state_unsafe_local_read")}function qs(){throw new Error("state_unsafe_mutation")}function _t(t){return{f:0,v:t,reactions:null,equals:Ke,version:0}}function Re(t){return Ws(_t(t))}function Ye(t,e=!1){var i;const s=_t(t);return e||(s.equals=Fs),I!==null&&I.l!==null&&((i=I.l).s??(i.s=[])).push(s),s}function Ws(t){return w!==null&&w.f&W&&(M===null?ri([t]):M.push(t)),t}function Pt(t,e){return w!==null&&le()&&w.f&(W|te)&&(M===null||!M.includes(t))&&qs(),Xt(t,e)}function Xt(t,e){return t.equals(e)||(t.v=e,t.version=hs(),Ze(t,G),le()&&v!==null&&v.f&P&&!(v.f&D)&&(T!==null&&T.includes(t)?(N(v,G),qt(v)):K===null?ai([t]):K.push(t))),e}function Ze(t,e){var s=t.reactions;if(s!==null)for(var i=le(),n=s.length,r=0;r<n;r++){var a=s[r],o=a.f;o&G||!i&&a===v||(N(a,e),o&(P|j)&&(o&W?Ze(a,pt):qt(a)))}}const ee=1,se=2,je=4,zs=8,Xs=16,Ks=2;let Gs=!1;var we,$e,Je;function Ys(){if(we===void 0){we=window;var t=Element.prototype,e=Node.prototype;$e=me(e,"firstChild").get,Je=me(e,"nextSibling").get,t.__click=void 0,t.__className="",t.__attributes=null,t.__styles=null,t.__e=void 0,Text.prototype.__t=void 0}}function ie(t=""){return document.createTextNode(t)}function Rt(t){return $e.call(t)}function Ht(t){return Je.call(t)}function Ut(t,e){return Rt(t)}function ye(t,e){{var s=Rt(t);return s instanceof Comment&&s.data===""?Ht(s):s}}function ht(t,e=1,s=!1){let i=t;for(;e--;)i=Ht(i);return i}function Zs(t){t.textContent=""}function Et(t){var e=W|G;v===null?e|=j:v.f|=Xe;const s={children:null,ctx:I,deps:null,equals:Ke,f:e,fn:t,reactions:null,v:null,version:0,parent:v};if(w!==null&&w.f&W){var i=w;(i.children??(i.children=[])).push(s)}return s}function Qe(t){var e=t.children;if(e!==null){t.children=null;for(var s=0;s<e.length;s+=1){var i=e[s];i.f&W?ne(i):$(i)}}}function ts(t){var e,s=v;ft(t.parent);try{Qe(t),e=xs(t)}finally{ft(s)}return e}function es(t){var e=ts(t),s=(et||t.f&j)&&t.deps!==null?pt:P;N(t,s),t.equals(e)||(t.v=e,t.version=hs())}function ne(t){Qe(t),wt(t,0),N(t,Bt),t.v=t.children=t.deps=t.ctx=t.reactions=null}function js(t){v===null&&w===null&&Ns(),w!==null&&w.f&j&&Ds(),fe&&Ms()}function $s(t,e){var s=e.last;s===null?e.last=e.first=t:(s.next=t,t.prev=s,e.last=t)}function lt(t,e,s,i=!0){var n=(t&Nt)!==0,r=v,a={ctx:I,deps:null,deriveds:null,nodes_start:null,nodes_end:null,f:t|G,first:null,fn:e,last:null,next:null,parent:n?null:r,prev:null,teardown:null,transitions:null,version:0};if(s){var o=rt;try{pe(!0),Lt(a),a.f|=As}catch(c){throw $(a),c}finally{pe(o)}}else e!==null&&qt(a);var d=s&&a.deps===null&&a.first===null&&a.nodes_start===null&&a.teardown===null&&(a.f&Xe)===0;if(!d&&!n&&i&&(r!==null&&$s(a,r),w!==null&&w.f&W)){var l=w;(l.children??(l.children=[])).push(a)}return a}function Js(t){const e=lt(yt,null,!1);return N(e,P),e.teardown=t,e}function Qs(t){js();var e=v!==null&&(v.f&D)!==0&&I!==null&&!I.m;if(e){var s=I;(s.e??(s.e=[])).push({fn:t,effect:v,reaction:w})}else{var i=re(t);return i}}function ti(t){const e=lt(Nt,t,!0);return()=>{$(e)}}function re(t){return lt(We,t,!1)}function ei(t){return lt(yt,t,!0)}function Ft(t){return ss(t)}function ss(t,e=0){return lt(yt|te|e,t,!0)}function ae(t,e=!0){return lt(yt|D,t,!0,e)}function is(t){var e=t.teardown;if(e!==null){const s=fe,i=w;Be(!0),ot(null);try{e.call(null)}finally{Be(s),ot(i)}}}function ns(t){var e=t.deriveds;if(e!==null){t.deriveds=null;for(var s=0;s<e.length;s+=1)ne(e[s])}}function rs(t,e=!1){var s=t.first;for(t.first=t.last=null;s!==null;){var i=s.next;$(s,e),s=i}}function si(t){for(var e=t.first;e!==null;){var s=e.next;e.f&D||$(e),e=s}}function $(t,e=!0){var s=!1;if((e||t.f&ks)&&t.nodes_start!==null){for(var i=t.nodes_start,n=t.nodes_end;i!==null;){var r=i===n?null:Ht(i);i.remove(),i=r}s=!0}ns(t),rs(t,e&&!s),wt(t,0),N(t,Bt);var a=t.transitions;if(a!==null)for(const d of a)d.stop();is(t);var o=t.parent;o!==null&&o.first!==null&&as(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.parent=t.fn=t.nodes_start=t.nodes_end=null}function as(t){var e=t.parent,s=t.prev,i=t.next;s!==null&&(s.next=i),i!==null&&(i.prev=s),e!==null&&(e.first===t&&(e.first=i),e.last===t&&(e.last=s))}function ii(t,e){var s=[];oe(t,s,!0),os(s,()=>{$(t),e&&e()})}function os(t,e){var s=t.length;if(s>0){var i=()=>--s||e();for(var n of t)n.out(i)}else e()}function oe(t,e,s){if(!(t.f&q)){if(t.f^=q,t.transitions!==null)for(const a of t.transitions)(a.is_global||s)&&e.push(a);for(var i=t.first;i!==null;){var n=i.next,r=(i.f&ze)!==0||(i.f&D)!==0;oe(i,e,r?s:!1),i=n}}}function fs(t){ls(t,!0)}function ls(t,e){if(t.f&q){t.f^=q,It(t)&&Lt(t);for(var s=t.first;s!==null;){var i=s.next,n=(s.f&ze)!==0||(s.f&D)!==0;ls(s,n?e:!1),s=i}if(t.transitions!==null)for(const r of t.transitions)(r.is_global||e)&&r.in()}}let Kt=!1,Gt=[];function ni(){Kt=!1;const t=Gt.slice();Gt=[],qe(t)}function cs(t){Kt||(Kt=!0,queueMicrotask(ni)),Gt.push(t)}let Mt=!1,rt=!1,fe=!1;function pe(t){rt=t}function Be(t){fe=t}let Yt=[],Ct=0;let w=null;function ot(t){w=t}let v=null;function ft(t){v=t}let M=null;function ri(t){M=t}let T=null,A=0,K=null;function ai(t){K=t}let ds=0,et=!1,I=null;function hs(){return++ds}function le(){return I!==null&&I.l===null}function It(t){var a,o;var e=t.f;if(e&G)return!0;if(e&pt){var s=t.deps,i=(e&j)!==0;if(s!==null){var n;if(e&Vt){for(n=0;n<s.length;n++)((a=s[n]).reactions??(a.reactions=[])).push(t);t.f^=Vt}for(n=0;n<s.length;n++){var r=s[n];if(It(r)&&es(r),i&&v!==null&&!et&&!((o=r==null?void 0:r.reactions)!=null&&o.includes(t))&&(r.reactions??(r.reactions=[])).push(t),r.version>t.version)return!0}}i||N(t,P)}return!1}function oi(t,e,s){throw t}function xs(t){var h;var e=T,s=A,i=K,n=w,r=et,a=M,o=I,d=t.f;T=null,A=0,K=null,w=d&(D|Nt)?null:t,et=!rt&&(d&j)!==0,M=null,I=t.ctx;try{var l=(0,t.fn)(),c=t.deps;if(T!==null){var f;if(wt(t,A),c!==null&&A>0)for(c.length=A+T.length,f=0;f<T.length;f++)c[A+f]=T[f];else t.deps=c=T;if(!et)for(f=A;f<c.length;f++)((h=c[f]).reactions??(h.reactions=[])).push(t)}else c!==null&&A<c.length&&(wt(t,A),c.length=A);return l}finally{T=e,A=s,K=i,w=n,et=r,M=a,I=o}}function fi(t,e){let s=e.reactions;if(s!==null){var i=s.indexOf(t);if(i!==-1){var n=s.length-1;n===0?s=e.reactions=null:(s[i]=s[n],s.pop())}}s===null&&e.f&W&&(T===null||!T.includes(e))&&(N(e,pt),e.f&(j|Vt)||(e.f^=Vt),wt(e,0))}function wt(t,e){var s=t.deps;if(s!==null)for(var i=e;i<s.length;i++)fi(t,s[i])}function Lt(t){var e=t.f;if(!(e&Bt)){N(t,P);var s=v;v=t;try{ns(t),e&te?si(t):rs(t),is(t);var i=xs(t);t.teardown=typeof i=="function"?i:null,t.version=ds}catch(n){oi(n)}finally{v=s}}}function li(){Ct>1e3&&(Ct=0,Hs()),Ct++}function ci(t){var e=t.length;if(e!==0){li();var s=rt;rt=!0;try{for(var i=0;i<e;i++){var n=t[i];n.f&P||(n.f^=P);var r=[];us(n,r),di(r)}}finally{rt=s}}}function di(t){var e=t.length;if(e!==0)for(var s=0;s<e;s++){var i=t[s];!(i.f&(Bt|q))&&It(i)&&(Lt(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?as(i):i.fn=null))}}function hi(){if(Mt=!1,Ct>1001)return;const t=Yt;Yt=[],ci(t),Mt||(Ct=0)}function qt(t){Mt||(Mt=!0,queueMicrotask(hi));for(var e=t;e.parent!==null;){e=e.parent;var s=e.f;if(s&(Nt|D)){if(!(s&P))return;e.f^=P}}Yt.push(e)}function us(t,e){var s=t.first,i=[];t:for(;s!==null;){var n=s.f,r=(n&D)!==0,a=r&&(n&P)!==0;if(!a&&!(n&q))if(n&yt){r?s.f^=P:It(s)&&Lt(s);var o=s.first;if(o!==null){s=o;continue}}else n&We&&i.push(s);var d=s.next;if(d===null){let f=s.parent;for(;f!==null;){if(t===f)break t;var l=f.next;if(l!==null){s=l;continue t}f=f.parent}}s=d}for(var c=0;c<i.length;c++)o=i[c],e.push(o),us(o,e)}function E(t){var o;var e=t.f,s=(e&W)!==0;if(s&&e&Bt){var i=ts(t);return ne(t),i}if(w!==null){M!==null&&M.includes(t)&&Ls();var n=w.deps;T===null&&n!==null&&n[A]===t?A++:T===null?T=[t]:T.push(t),K!==null&&v!==null&&v.f&P&&!(v.f&D)&&K.includes(t)&&(N(v,G),qt(v))}else if(s&&t.deps===null){var r=t,a=r.parent;a!==null&&!((o=a.deriveds)!=null&&o.includes(r))&&(a.deriveds??(a.deriveds=[])).push(r)}return s&&(r=t,It(r)&&es(r)),t.v}function Cs(t){const e=w;try{return w=null,t()}finally{w=e}}const xi=~(G|pt|P);function N(t,e){t.f=t.f&xi|e}function gs(t,e=!1,s){I={p:I,c:null,e:null,m:!1,s:t,x:null,l:null},e||(I.l={s:null,u:null,r1:[],r2:_t(!1)})}function vs(t){const e=I;if(e!==null){const a=e.e;if(a!==null){var s=v,i=w;e.e=null;try{for(var n=0;n<a.length;n++){var r=a[n];ft(r.effect),ot(r.reaction),re(r.fn)}}finally{ft(s),ot(i)}}I=e.p,e.m=!0}return{}}const ms=new Set,Zt=new Set;function ui(t){for(var e=0;e<t.length;e++)ms.add(t[e]);for(var s of Zt)s(t)}function Tt(t){var y;var e=this,s=e.ownerDocument,i=t.type,n=((y=t.composedPath)==null?void 0:y.call(t))||[],r=n[0]||t.target,a=0,o=t.__root;if(o){var d=n.indexOf(o);if(d!==-1&&(e===document||e===window)){t.__root=e;return}var l=n.indexOf(e);if(l===-1)return;d<=l&&(a=d)}if(r=n[a]||t.target,r!==e){Ps(t,"currentTarget",{configurable:!0,get(){return r||s}});var c=w,f=v;ot(null),ft(null);try{for(var h,x=[];r!==null;){var u=r.assignedSlot||r.parentNode||r.host||null;try{var m=r["__"+i];if(m!==void 0&&!r.disabled)if(Le(m)){var[B,...U]=m;B.apply(r,[t,...U])}else m.call(r,t)}catch(g){h?x.push(g):h=g}if(t.cancelBubble||u===e||u===null)break;r=u}if(h){for(let g of x)queueMicrotask(()=>{throw g});throw h}}finally{t.__root=e,delete t.currentTarget,ot(c),ft(f)}}}function _s(t){var e=document.createElement("template");return e.innerHTML=t,e.content}function ce(t,e){var s=v;s.nodes_start===null&&(s.nodes_start=t,s.nodes_end=e)}function Rs(t,e){var s=(e&Ks)!==0,i,n=!t.startsWith("<!>");return()=>{i===void 0&&(i=_s(n?t:"<!>"+t),i=Rt(i));var r=s?document.importNode(i,!0):i.cloneNode(!0);return ce(r,r),r}}function ws(t,e,s="svg"){var i=!t.startsWith("<!>"),n=`<${s}>${i?t:"<!>"+t}</${s}>`,r;return()=>{if(!r){var a=_s(n),o=Rt(a);r=Rt(o)}var d=r.cloneNode(!0);return ce(d,d),d}}function Ie(){var t=document.createDocumentFragment(),e=document.createComment(""),s=ie();return t.append(e,s),ce(e,s),t}function st(t,e){t!==null&&t.before(e)}const Ci=["touchstart","touchmove"];function gi(t){return Ci.includes(t)}function Ue(t,e){var s=e==null?"":typeof e=="object"?e+"":e;s!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=s,t.nodeValue=s==null?"":s+"")}function vi(t,e){return mi(t,e)}const Q=new Map;function mi(t,{target:e,anchor:s,props:i={},events:n,context:r,intro:a=!0}){Ys();var o=new Set,d=f=>{for(var h=0;h<f.length;h++){var x=f[h];if(!o.has(x)){o.add(x);var u=gi(x);e.addEventListener(x,Tt,{passive:u});var m=Q.get(x);m===void 0?(document.addEventListener(x,Tt,{passive:u}),Q.set(x,1)):Q.set(x,m+1)}}};d(Qt(ms)),Zt.add(d);var l=void 0,c=ti(()=>{var f=s??e.appendChild(ie());return ae(()=>{if(r){gs({});var h=I;h.c=r}n&&(i.$$events=n),l=t(f,i)||{},r&&vs()}),()=>{var u;for(var h of o){e.removeEventListener(h,Tt);var x=Q.get(h);--x===0?(document.removeEventListener(h,Tt),Q.delete(h)):Q.set(h,x)}Zt.delete(d),Ee.delete(l),f!==s&&((u=f.parentNode)==null||u.removeChild(f))}});return Ee.set(l,c),l}let Ee=new WeakMap,zt=null;function bt(t,e){return e}function _i(t,e,s,i){for(var n=[],r=e.length,a=0;a<r;a++)oe(e[a].e,n,!0);var o=r>0&&n.length===0&&s!==null;if(o){var d=s.parentNode;Zs(d),d.append(s),i.clear(),z(t,e[0].prev,e[r-1].next)}os(n,()=>{for(var l=0;l<r;l++){var c=e[l];o||(i.delete(c.k),z(t,c.prev,c.next)),$(c.e,!o)}})}function At(t,e,s,i,n,r=null){var a=t,o={flags:e,items:new Map,first:null},d=(e&je)!==0;if(d){var l=t;a=l.appendChild(ie())}var c=null,f=!1;ss(()=>{var h=s(),x=Le(h)?h:h==null?[]:Qt(h),u=x.length;f&&u===0||(f=u===0,Ri(x,o,a,n,e,i),r!==null&&(u===0?c?fs(c):c=ae(()=>r(a)):c!==null&&ii(c,()=>{c=null})),s())})}function Ri(t,e,s,i,n,r){var xe,ue,Ce,ge;var a=(n&zs)!==0,o=(n&(ee|se))!==0,d=t.length,l=e.items,c=e.first,f=c,h,x=null,u,m=[],B=[],U,y,g,_;if(a)for(_=0;_<d;_+=1)U=t[_],y=r(U,_),g=l.get(y),g!==void 0&&((xe=g.a)==null||xe.measure(),(u??(u=new Set)).add(g));for(_=0;_<d;_+=1){if(U=t[_],y=r(U,_),g=l.get(y),g===void 0){var H=f?f.e.nodes_start:s;x=yi(H,e,x,x===null?e.first:x.next,U,y,_,i,n),l.set(y,x),m=[],B=[],f=x.next;continue}if(o&&wi(g,U,_,n),g.e.f&q&&(fs(g.e),a&&((ue=g.a)==null||ue.unfix(),(u??(u=new Set)).delete(g))),g!==f){if(h!==void 0&&h.has(g)){if(m.length<B.length){var k=B[0],O;x=k.prev;var J=m[0],ct=m[m.length-1];for(O=0;O<m.length;O+=1)Te(m[O],k,s);for(O=0;O<B.length;O+=1)h.delete(B[O]);z(e,J.prev,ct.next),z(e,x,J),z(e,ct,k),f=k,x=ct,_-=1,m=[],B=[]}else h.delete(g),Te(g,f,s),z(e,g.prev,g.next),z(e,g,x===null?e.first:x.next),z(e,x,g),x=g;continue}for(m=[],B=[];f!==null&&f.k!==y;)f.e.f&q||(h??(h=new Set)).add(f),B.push(f),f=f.next;if(f===null)continue;g=f}m.push(g),x=g,f=g.next}if(f!==null||h!==void 0){for(var dt=h===void 0?[]:Qt(h);f!==null;)f.e.f&q||dt.push(f),f=f.next;var Wt=dt.length;if(Wt>0){var Us=n&je&&d===0?s:null;if(a){for(_=0;_<Wt;_+=1)(Ce=dt[_].a)==null||Ce.measure();for(_=0;_<Wt;_+=1)(ge=dt[_].a)==null||ge.fix()}_i(e,dt,Us,l)}}a&&cs(()=>{var ve;if(u!==void 0)for(g of u)(ve=g.a)==null||ve.apply()}),v.first=e.first&&e.first.e,v.last=x&&x.e}function wi(t,e,s,i){i&ee&&Xt(t.v,e),i&se?Xt(t.i,s):t.i=s}function yi(t,e,s,i,n,r,a,o,d){var l=zt;try{var c=(d&ee)!==0,f=(d&Xs)===0,h=c?f?Ye(n):_t(n):n,x=d&se?_t(a):a,u={i:x,v:h,k:r,a:null,e:null,prev:s,next:i};return zt=u,u.e=ae(()=>o(t,h,x),Gs),u.e.prev=s&&s.e,u.e.next=i&&i.e,s===null?e.first=u:(s.next=u,s.e.next=u.e),i!==null&&(i.prev=u,i.e.prev=u.e),u}finally{zt=l}}function Te(t,e,s){for(var i=t.next?t.next.e.nodes_start:s,n=e?e.e.nodes_start:s,r=t.e.nodes_start;r!==i;){var a=Ht(r);n.before(r),r=a}}function z(t,e,s){e===null?t.first=s:(e.next=s,e.e.next=s&&s.e),s!==null&&(s.prev=e,s.e.prev=e&&e.e)}function Y(t,e,s,i){var n=t.__attributes??(t.__attributes={});n[e]!==(n[e]=s)&&(e==="style"&&"__styles"in t&&(t.__styles={}),e==="loading"&&(t[Vs]=s),s==null?t.removeAttribute(e):typeof s!="string"&&pi(t).includes(e)?t[e]=s:t.setAttribute(e,s))}var Se=new Map;function pi(t){var e=Se.get(t.nodeName);if(e)return e;Se.set(t.nodeName,e=[]);for(var s,i=_e(t),n=Element.prototype;n!==i;){s=bs(i);for(var r in s)s[r].set&&e.push(r);i=_e(i)}return e}function Pe(t,e){return t===e||(t==null?void 0:t[Os])===e}function Bi(t={},e,s,i){return re(()=>{var n,r;return ei(()=>{n=r,r=[],Cs(()=>{t!==s(...r)&&(e(t,...r),n&&Pe(s(...n),t)&&e(null,...n))})}),()=>{cs(()=>{r&&Pe(s(...r),t)&&e(null,...r)})}}),t}function ys(t,e,s){if(t==null)return e(void 0),s&&s(void 0),X;const i=Cs(()=>t.subscribe(e,s));return i.unsubscribe?()=>i.unsubscribe():i}function Ii(t,e,s){const i=s[e]??(s[e]={store:null,source:Ye(void 0),unsubscribe:X});if(i.store!==t)if(i.unsubscribe(),i.store=t??null,t==null)i.source.v=void 0,i.unsubscribe=X;else{var n=!0;i.unsubscribe=ys(t,r=>{n?i.source.v=r:Pt(i.source,r)}),n=!1}return E(i.source)}function Ui(){const t={};return Js(()=>{for(var e in t)t[e].unsubscribe()}),t}const Ei="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ei);function Ti(t,e){const s=t.dataView.getUint16(93,!0);t.data[s]=t.pc&255,t.data[s-1]=t.pc>>8&255,t.pc22Bits&&(t.data[s-2]=t.pc>>16&255),t.dataView.setUint16(93,s-(t.pc22Bits?3:2),!0),t.data[95]&=127,t.cycles+=2,t.pc=e}const Si=256,Pi=128;class bi{constructor(e,s=8192){this.progMem=e,this.sramBytes=s,this.data=new Uint8Array(this.sramBytes+Si),this.data16=new Uint16Array(this.data.buffer),this.dataView=new DataView(this.data.buffer),this.progBytes=new Uint8Array(this.progMem.buffer),this.readHooks=[],this.writeHooks=[],this.pendingInterrupts=new Array(Pi),this.nextClockEvent=null,this.clockEventPool=[],this.pc22Bits=this.progBytes.length>131072,this.gpioPorts=new Set,this.gpioByPort=[],this.onWatchdogReset=()=>{},this.pc=0,this.cycles=0,this.nextInterrupt=-1,this.maxInterrupt=0,this.reset()}reset(){this.SP=this.data.length-1,this.pc=0,this.pendingInterrupts.fill(null),this.nextInterrupt=-1,this.nextClockEvent=null}readData(e){return e>=32&&this.readHooks[e]?this.readHooks[e](e):this.data[e]}writeData(e,s,i=255){const n=this.writeHooks[e];n&&n(s,this.data[e],e,i)||(this.data[e]=s)}get SP(){return this.dataView.getUint16(93,!0)}set SP(e){this.dataView.setUint16(93,e,!0)}get SREG(){return this.data[95]}get interruptsEnabled(){return!!(this.SREG&128)}setInterruptFlag(e){const{flagRegister:s,flagMask:i,enableRegister:n,enableMask:r}=e;e.inverseFlag?this.data[s]&=~i:this.data[s]|=i,this.data[n]&r&&this.queueInterrupt(e)}updateInterruptEnable(e,s){const{enableMask:i,flagRegister:n,flagMask:r,inverseFlag:a}=e;if(s&i){const o=this.data[n]&r;(a?!o:o)&&this.queueInterrupt(e)}else this.clearInterrupt(e,!1)}queueInterrupt(e){const{address:s}=e;this.pendingInterrupts[s]=e,(this.nextInterrupt===-1||this.nextInterrupt>s)&&(this.nextInterrupt=s),s>this.maxInterrupt&&(this.maxInterrupt=s)}clearInterrupt({address:e,flagRegister:s,flagMask:i},n=!0){n&&(this.data[s]&=~i);const{pendingInterrupts:r,maxInterrupt:a}=this;if(r[e]&&(r[e]=null,this.nextInterrupt===e)){this.nextInterrupt=-1;for(let o=e+1;o<=a;o++)if(r[o]){this.nextInterrupt=o;break}}}clearInterruptByFlag(e,s){const{flagRegister:i,flagMask:n}=e;s&n&&(this.data[i]&=~n,this.clearInterrupt(e))}addClockEvent(e,s){const{clockEventPool:i}=this;s=this.cycles+Math.max(1,s);const n=i.pop(),r=n??{cycles:s,callback:e,next:null};r.cycles=s,r.callback=e;let{nextClockEvent:a}=this,o=null;for(;a&&a.cycles<s;)o=a,a=a.next;return o?(o.next=r,r.next=a):(this.nextClockEvent=r,r.next=a),e}updateClockEvent(e,s){return this.clearClockEvent(e)?(this.addClockEvent(e,s),!0):!1}clearClockEvent(e){let{nextClockEvent:s}=this;if(!s)return!1;const{clockEventPool:i}=this;let n=null;for(;s;){if(s.callback===e)return n?n.next=s.next:this.nextClockEvent=s.next,i.length<10&&i.push(s),!0;n=s,s=s.next}return!1}tick(){const{nextClockEvent:e}=this;e&&e.cycles<=this.cycles&&(e.callback(),this.nextClockEvent=e.next,this.clockEventPool.length<10&&this.clockEventPool.push(e));const{nextInterrupt:s}=this;if(this.interruptsEnabled&&s>=0){const i=this.pendingInterrupts[s];Ti(this,i.address),i.constant||this.clearInterrupt(i)}}}function xt(t){return(t&65039)===36864||(t&65039)===37376||(t&65038)===37902||(t&65038)===37900}function Ai(t){const e=t.progMem[t.pc];if((e&64512)===7168){const s=t.data[(e&496)>>4],i=t.data[e&15|(e&512)>>5],n=s+i+(t.data[95]&1),r=n&255;t.data[(e&496)>>4]=r;let a=t.data[95]&192;a|=r?0:2,a|=128&r?4:0,a|=(r^i)&(s^r)&128?8:0,a|=a>>2&1^a>>3&1?16:0,a|=n&256?1:0,a|=1&(s&i|i&~r|~r&s)?32:0,t.data[95]=a}else if((e&64512)===3072){const s=t.data[(e&496)>>4],i=t.data[e&15|(e&512)>>5],n=s+i&255;t.data[(e&496)>>4]=n;let r=t.data[95]&192;r|=n?0:2,r|=128&n?4:0,r|=(n^i)&(n^s)&128?8:0,r|=r>>2&1^r>>3&1?16:0,r|=s+i&256?1:0,r|=1&(s&i|i&~n|~n&s)?32:0,t.data[95]=r}else if((e&65280)===38400){const s=2*((e&48)>>4)+24,i=t.dataView.getUint16(s,!0),n=i+(e&15|(e&192)>>2)&65535;t.dataView.setUint16(s,n,!0);let r=t.data[95]&224;r|=n?0:2,r|=32768&n?4:0,r|=~i&n&32768?8:0,r|=r>>2&1^r>>3&1?16:0,r|=~n&i&32768?1:0,t.data[95]=r,t.cycles++}else if((e&64512)===8192){const s=t.data[(e&496)>>4]&t.data[e&15|(e&512)>>5];t.data[(e&496)>>4]=s;let i=t.data[95]&225;i|=s?0:2,i|=128&s?4:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if((e&61440)===28672){const s=t.data[((e&240)>>4)+16]&(e&15|(e&3840)>>4);t.data[((e&240)>>4)+16]=s;let i=t.data[95]&225;i|=s?0:2,i|=128&s?4:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if((e&65039)===37893){const s=t.data[(e&496)>>4],i=s>>>1|128&s;t.data[(e&496)>>4]=i;let n=t.data[95]&224;n|=i?0:2,n|=128&i?4:0,n|=s&1,n|=n>>2&1^n&1?8:0,n|=n>>2&1^n>>3&1?16:0,t.data[95]=n}else if((e&65423)===38024)t.data[95]&=~(1<<((e&112)>>4));else if((e&65032)===63488){const s=e&7,i=(e&496)>>4;t.data[i]=~(1<<s)&t.data[i]|(t.data[95]>>6&1)<<s}else if((e&64512)===62464)t.data[95]&1<<(e&7)||(t.pc=t.pc+(((e&504)>>3)-(e&512?64:0)),t.cycles++);else if((e&64512)===61440)t.data[95]&1<<(e&7)&&(t.pc=t.pc+(((e&504)>>3)-(e&512?64:0)),t.cycles++);else if((e&65423)===37896)t.data[95]|=1<<((e&112)>>4);else if((e&65032)===64e3){const s=t.data[(e&496)>>4],i=e&7;t.data[95]=t.data[95]&191|(s>>i&1?64:0)}else if((e&65038)===37902){const s=t.progMem[t.pc+1]|(e&1)<<16|(e&496)<<13,i=t.pc+2,n=t.dataView.getUint16(93,!0),{pc22Bits:r}=t;t.data[n]=255&i,t.data[n-1]=i>>8&255,r&&(t.data[n-2]=i>>16&255),t.dataView.setUint16(93,n-(r?3:2),!0),t.pc=s-1,t.cycles+=r?4:3}else if((e&65280)===38912){const s=e&248,i=e&7,n=t.readData((s>>3)+32),r=1<<i;t.writeData((s>>3)+32,n&~r,r)}else if((e&65039)===37888){const s=(e&496)>>4,i=255-t.data[s];t.data[s]=i;let n=t.data[95]&225|1;n|=i?0:2,n|=128&i?4:0,n|=n>>2&1^n>>3&1?16:0,t.data[95]=n}else if((e&64512)===5120){const s=t.data[(e&496)>>4],i=t.data[e&15|(e&512)>>5],n=s-i;let r=t.data[95]&192;r|=n?0:2,r|=128&n?4:0,r|=(s^i)&(s^n)&128?8:0,r|=r>>2&1^r>>3&1?16:0,r|=i>s?1:0,r|=1&(~s&i|i&n|n&~s)?32:0,t.data[95]=r}else if((e&64512)===1024){const s=t.data[(e&496)>>4],i=t.data[e&15|(e&512)>>5];let n=t.data[95];const r=s-i-(n&1);n=n&192|(!r&&n>>1&1?2:0)|(i+(n&1)>s?1:0),n|=128&r?4:0,n|=(s^i)&(s^r)&128?8:0,n|=n>>2&1^n>>3&1?16:0,n|=1&(~s&i|i&r|r&~s)?32:0,t.data[95]=n}else if((e&61440)===12288){const s=t.data[((e&240)>>4)+16],i=e&15|(e&3840)>>4,n=s-i;let r=t.data[95]&192;r|=n?0:2,r|=128&n?4:0,r|=(s^i)&(s^n)&128?8:0,r|=r>>2&1^r>>3&1?16:0,r|=i>s?1:0,r|=1&(~s&i|i&n|n&~s)?32:0,t.data[95]=r}else if((e&64512)===4096){if(t.data[(e&496)>>4]===t.data[e&15|(e&512)>>5]){const s=t.progMem[t.pc+1],i=xt(s)?2:1;t.pc+=i,t.cycles+=i}}else if((e&65039)===37898){const s=t.data[(e&496)>>4],i=s-1;t.data[(e&496)>>4]=i;let n=t.data[95]&225;n|=i?0:2,n|=128&i?4:0,n|=s===128?8:0,n|=n>>2&1^n>>3&1?16:0,t.data[95]=n}else if(e===38169){const s=t.pc+1,i=t.dataView.getUint16(93,!0),n=t.data[92];t.data[i]=s&255,t.data[i-1]=s>>8&255,t.data[i-2]=s>>16&255,t.dataView.setUint16(93,i-3,!0),t.pc=(n<<16|t.dataView.getUint16(30,!0))-1,t.cycles+=3}else if(e===37913){const s=t.data[92];t.pc=(s<<16|t.dataView.getUint16(30,!0))-1,t.cycles++}else if(e===38360){const s=t.data[91];t.data[0]=t.progBytes[s<<16|t.dataView.getUint16(30,!0)],t.cycles+=2}else if((e&65039)===36870){const s=t.data[91];t.data[(e&496)>>4]=t.progBytes[s<<16|t.dataView.getUint16(30,!0)],t.cycles+=2}else if((e&65039)===36871){const s=t.data[91],i=t.dataView.getUint16(30,!0);t.data[(e&496)>>4]=t.progBytes[s<<16|i],t.dataView.setUint16(30,i+1,!0),i===65535&&(t.data[91]=(s+1)%(t.progBytes.length>>16)),t.cycles+=2}else if((e&64512)===9216){const s=t.data[(e&496)>>4]^t.data[e&15|(e&512)>>5];t.data[(e&496)>>4]=s;let i=t.data[95]&225;i|=s?0:2,i|=128&s?4:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if((e&65416)===776){const s=t.data[((e&112)>>4)+16],i=t.data[(e&7)+16],n=s*i<<1;t.dataView.setUint16(0,n,!0),t.data[95]=t.data[95]&252|(65535&n?0:2)|(s*i&32768?1:0),t.cycles++}else if((e&65416)===896){const s=t.dataView.getInt8(((e&112)>>4)+16),i=t.dataView.getInt8((e&7)+16),n=s*i<<1;t.dataView.setInt16(0,n,!0),t.data[95]=t.data[95]&252|(65535&n?0:2)|(s*i&32768?1:0),t.cycles++}else if((e&65416)===904){const s=t.dataView.getInt8(((e&112)>>4)+16),i=t.data[(e&7)+16],n=s*i<<1;t.dataView.setInt16(0,n,!0),t.data[95]=t.data[95]&252|(65535&n?2:0)|(s*i&32768?1:0),t.cycles++}else if(e===38153){const s=t.pc+1,i=t.dataView.getUint16(93,!0),{pc22Bits:n}=t;t.data[i]=s&255,t.data[i-1]=s>>8&255,n&&(t.data[i-2]=s>>16&255),t.dataView.setUint16(93,i-(n?3:2),!0),t.pc=t.dataView.getUint16(30,!0)-1,t.cycles+=n?3:2}else if(e===37897)t.pc=t.dataView.getUint16(30,!0)-1,t.cycles++;else if((e&63488)===45056){const s=t.readData((e&15|(e&1536)>>5)+32);t.data[(e&496)>>4]=s}else if((e&65039)===37891){const s=t.data[(e&496)>>4],i=s+1&255;t.data[(e&496)>>4]=i;let n=t.data[95]&225;n|=i?0:2,n|=128&i?4:0,n|=s===127?8:0,n|=n>>2&1^n>>3&1?16:0,t.data[95]=n}else if((e&65038)===37900)t.pc=(t.progMem[t.pc+1]|(e&1)<<16|(e&496)<<13)-1,t.cycles+=2;else if((e&65039)===37382){const s=(e&496)>>4,i=t.data[s],n=t.readData(t.dataView.getUint16(30,!0));t.writeData(t.dataView.getUint16(30,!0),n&255-i),t.data[s]=n}else if((e&65039)===37381){const s=(e&496)>>4,i=t.data[s],n=t.readData(t.dataView.getUint16(30,!0));t.writeData(t.dataView.getUint16(30,!0),n|i),t.data[s]=n}else if((e&65039)===37383){const s=t.data[(e&496)>>4],i=t.readData(t.dataView.getUint16(30,!0));t.writeData(t.dataView.getUint16(30,!0),s^i),t.data[(e&496)>>4]=i}else if((e&61440)===57344)t.data[((e&240)>>4)+16]=e&15|(e&3840)>>4;else if((e&65039)===36864){t.cycles++;const s=t.readData(t.progMem[t.pc+1]);t.data[(e&496)>>4]=s,t.pc++}else if((e&65039)===36876)t.cycles++,t.data[(e&496)>>4]=t.readData(t.dataView.getUint16(26,!0));else if((e&65039)===36877){const s=t.dataView.getUint16(26,!0);t.cycles++,t.data[(e&496)>>4]=t.readData(s),t.dataView.setUint16(26,s+1,!0)}else if((e&65039)===36878){const s=t.dataView.getUint16(26,!0)-1;t.dataView.setUint16(26,s,!0),t.cycles++,t.data[(e&496)>>4]=t.readData(s)}else if((e&65039)===32776)t.cycles++,t.data[(e&496)>>4]=t.readData(t.dataView.getUint16(28,!0));else if((e&65039)===36873){const s=t.dataView.getUint16(28,!0);t.cycles++,t.data[(e&496)>>4]=t.readData(s),t.dataView.setUint16(28,s+1,!0)}else if((e&65039)===36874){const s=t.dataView.getUint16(28,!0)-1;t.dataView.setUint16(28,s,!0),t.cycles++,t.data[(e&496)>>4]=t.readData(s)}else if((e&53768)===32776&&e&7|(e&3072)>>7|(e&8192)>>8)t.cycles++,t.data[(e&496)>>4]=t.readData(t.dataView.getUint16(28,!0)+(e&7|(e&3072)>>7|(e&8192)>>8));else if((e&65039)===32768)t.cycles++,t.data[(e&496)>>4]=t.readData(t.dataView.getUint16(30,!0));else if((e&65039)===36865){const s=t.dataView.getUint16(30,!0);t.cycles++,t.data[(e&496)>>4]=t.readData(s),t.dataView.setUint16(30,s+1,!0)}else if((e&65039)===36866){const s=t.dataView.getUint16(30,!0)-1;t.dataView.setUint16(30,s,!0),t.cycles++,t.data[(e&496)>>4]=t.readData(s)}else if((e&53768)===32768&&e&7|(e&3072)>>7|(e&8192)>>8)t.cycles++,t.data[(e&496)>>4]=t.readData(t.dataView.getUint16(30,!0)+(e&7|(e&3072)>>7|(e&8192)>>8));else if(e===38344)t.data[0]=t.progBytes[t.dataView.getUint16(30,!0)],t.cycles+=2;else if((e&65039)===36868)t.data[(e&496)>>4]=t.progBytes[t.dataView.getUint16(30,!0)],t.cycles+=2;else if((e&65039)===36869){const s=t.dataView.getUint16(30,!0);t.data[(e&496)>>4]=t.progBytes[s],t.dataView.setUint16(30,s+1,!0),t.cycles+=2}else if((e&65039)===37894){const s=t.data[(e&496)>>4],i=s>>>1;t.data[(e&496)>>4]=i;let n=t.data[95]&224;n|=i?0:2,n|=s&1,n|=n>>2&1^n&1?8:0,n|=n>>2&1^n>>3&1?16:0,t.data[95]=n}else if((e&64512)===11264)t.data[(e&496)>>4]=t.data[e&15|(e&512)>>5];else if((e&65280)===256){const s=2*(e&15),i=2*((e&240)>>4);t.data[i]=t.data[s],t.data[i+1]=t.data[s+1]}else if((e&64512)===39936){const s=t.data[(e&496)>>4]*t.data[e&15|(e&512)>>5];t.dataView.setUint16(0,s,!0),t.data[95]=t.data[95]&252|(65535&s?0:2)|(32768&s?1:0),t.cycles++}else if((e&65280)===512){const s=t.dataView.getInt8(((e&240)>>4)+16)*t.dataView.getInt8((e&15)+16);t.dataView.setInt16(0,s,!0),t.data[95]=t.data[95]&252|(65535&s?0:2)|(32768&s?1:0),t.cycles++}else if((e&65416)===768){const s=t.dataView.getInt8(((e&112)>>4)+16)*t.data[(e&7)+16];t.dataView.setInt16(0,s,!0),t.data[95]=t.data[95]&252|(65535&s?0:2)|(32768&s?1:0),t.cycles++}else if((e&65039)===37889){const s=(e&496)>>4,i=t.data[s],n=0-i;t.data[s]=n;let r=t.data[95]&192;r|=n?0:2,r|=128&n?4:0,r|=n===128?8:0,r|=r>>2&1^r>>3&1?16:0,r|=n?1:0,r|=1&(n|i)?32:0,t.data[95]=r}else if(e!==0){if((e&64512)===10240){const s=t.data[(e&496)>>4]|t.data[e&15|(e&512)>>5];t.data[(e&496)>>4]=s;let i=t.data[95]&225;i|=s?0:2,i|=128&s?4:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if((e&61440)===24576){const s=t.data[((e&240)>>4)+16]|(e&15|(e&3840)>>4);t.data[((e&240)>>4)+16]=s;let i=t.data[95]&225;i|=s?0:2,i|=128&s?4:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if((e&63488)===47104)t.writeData((e&15|(e&1536)>>5)+32,t.data[(e&496)>>4]);else if((e&65039)===36879){const s=t.dataView.getUint16(93,!0)+1;t.dataView.setUint16(93,s,!0),t.data[(e&496)>>4]=t.data[s],t.cycles++}else if((e&65039)===37391){const s=t.dataView.getUint16(93,!0);t.data[s]=t.data[(e&496)>>4],t.dataView.setUint16(93,s-1,!0),t.cycles++}else if((e&61440)===53248){const s=(e&2047)-(e&2048?2048:0),i=t.pc+1,n=t.dataView.getUint16(93,!0),{pc22Bits:r}=t;t.data[n]=255&i,t.data[n-1]=i>>8&255,r&&(t.data[n-2]=i>>16&255),t.dataView.setUint16(93,n-(r?3:2),!0),t.pc+=s,t.cycles+=r?3:2}else if(e===38152){const{pc22Bits:s}=t,i=t.dataView.getUint16(93,!0)+(s?3:2);t.dataView.setUint16(93,i,!0),t.pc=(t.data[i-1]<<8)+t.data[i]-1,s&&(t.pc|=t.data[i-2]<<16),t.cycles+=s?4:3}else if(e===38168){const{pc22Bits:s}=t,i=t.dataView.getUint16(93,!0)+(s?3:2);t.dataView.setUint16(93,i,!0),t.pc=(t.data[i-1]<<8)+t.data[i]-1,s&&(t.pc|=t.data[i-2]<<16),t.cycles+=s?4:3,t.data[95]|=128}else if((e&61440)===49152)t.pc=t.pc+((e&2047)-(e&2048?2048:0)),t.cycles++;else if((e&65039)===37895){const s=t.data[(e&496)>>4],i=s>>>1|(t.data[95]&1)<<7;t.data[(e&496)>>4]=i;let n=t.data[95]&224;n|=i?0:2,n|=128&i?4:0,n|=1&s?1:0,n|=n>>2&1^n&1?8:0,n|=n>>2&1^n>>3&1?16:0,t.data[95]=n}else if((e&64512)===2048){const s=t.data[(e&496)>>4],i=t.data[e&15|(e&512)>>5];let n=t.data[95];const r=s-i-(n&1);t.data[(e&496)>>4]=r,n=n&192|(!r&&n>>1&1?2:0)|(i+(n&1)>s?1:0),n|=128&r?4:0,n|=(s^i)&(s^r)&128?8:0,n|=n>>2&1^n>>3&1?16:0,n|=1&(~s&i|i&r|r&~s)?32:0,t.data[95]=n}else if((e&61440)===16384){const s=t.data[((e&240)>>4)+16],i=e&15|(e&3840)>>4;let n=t.data[95];const r=s-i-(n&1);t.data[((e&240)>>4)+16]=r,n=n&192|(!r&&n>>1&1?2:0)|(i+(n&1)>s?1:0),n|=128&r?4:0,n|=(s^i)&(s^r)&128?8:0,n|=n>>2&1^n>>3&1?16:0,n|=1&(~s&i|i&r|r&~s)?32:0,t.data[95]=n}else if((e&65280)===39424){const s=((e&248)>>3)+32,i=1<<(e&7);t.writeData(s,t.readData(s)|i,i),t.cycles++}else if((e&65280)===39168){if(!(t.readData(((e&248)>>3)+32)&1<<(e&7))){const i=t.progMem[t.pc+1],n=xt(i)?2:1;t.cycles+=n,t.pc+=n}}else if((e&65280)===39680){if(t.readData(((e&248)>>3)+32)&1<<(e&7)){const i=t.progMem[t.pc+1],n=xt(i)?2:1;t.cycles+=n,t.pc+=n}}else if((e&65280)===38656){const s=2*((e&48)>>4)+24,i=t.dataView.getUint16(s,!0),n=e&15|(e&192)>>2,r=i-n;t.dataView.setUint16(s,r,!0);let a=t.data[95]&192;a|=r?0:2,a|=32768&r?4:0,a|=i&~r&32768?8:0,a|=a>>2&1^a>>3&1?16:0,a|=n>i?1:0,a|=1&(~i&n|n&r|r&~i)?32:0,t.data[95]=a,t.cycles++}else if((e&65032)===64512){if(!(t.data[(e&496)>>4]&1<<(e&7))){const s=t.progMem[t.pc+1],i=xt(s)?2:1;t.cycles+=i,t.pc+=i}}else if((e&65032)===65024){if(t.data[(e&496)>>4]&1<<(e&7)){const s=t.progMem[t.pc+1],i=xt(s)?2:1;t.cycles+=i,t.pc+=i}}else if(e!==38280){if(e!==38376){if(e!==38392){if((e&65039)===37376){const s=t.data[(e&496)>>4],i=t.progMem[t.pc+1];t.writeData(i,s),t.pc++,t.cycles++}else if((e&65039)===37388)t.writeData(t.dataView.getUint16(26,!0),t.data[(e&496)>>4]),t.cycles++;else if((e&65039)===37389){const s=t.dataView.getUint16(26,!0);t.writeData(s,t.data[(e&496)>>4]),t.dataView.setUint16(26,s+1,!0),t.cycles++}else if((e&65039)===37390){const s=t.data[(e&496)>>4],i=t.dataView.getUint16(26,!0)-1;t.dataView.setUint16(26,i,!0),t.writeData(i,s),t.cycles++}else if((e&65039)===33288)t.writeData(t.dataView.getUint16(28,!0),t.data[(e&496)>>4]),t.cycles++;else if((e&65039)===37385){const s=t.data[(e&496)>>4],i=t.dataView.getUint16(28,!0);t.writeData(i,s),t.dataView.setUint16(28,i+1,!0),t.cycles++}else if((e&65039)===37386){const s=t.data[(e&496)>>4],i=t.dataView.getUint16(28,!0)-1;t.dataView.setUint16(28,i,!0),t.writeData(i,s),t.cycles++}else if((e&53768)===33288&&e&7|(e&3072)>>7|(e&8192)>>8)t.writeData(t.dataView.getUint16(28,!0)+(e&7|(e&3072)>>7|(e&8192)>>8),t.data[(e&496)>>4]),t.cycles++;else if((e&65039)===33280)t.writeData(t.dataView.getUint16(30,!0),t.data[(e&496)>>4]),t.cycles++;else if((e&65039)===37377){const s=t.dataView.getUint16(30,!0);t.writeData(s,t.data[(e&496)>>4]),t.dataView.setUint16(30,s+1,!0),t.cycles++}else if((e&65039)===37378){const s=t.data[(e&496)>>4],i=t.dataView.getUint16(30,!0)-1;t.dataView.setUint16(30,i,!0),t.writeData(i,s),t.cycles++}else if((e&53768)===33280&&e&7|(e&3072)>>7|(e&8192)>>8)t.writeData(t.dataView.getUint16(30,!0)+(e&7|(e&3072)>>7|(e&8192)>>8),t.data[(e&496)>>4]),t.cycles++;else if((e&64512)===6144){const s=t.data[(e&496)>>4],i=t.data[e&15|(e&512)>>5],n=s-i;t.data[(e&496)>>4]=n;let r=t.data[95]&192;r|=n?0:2,r|=128&n?4:0,r|=(s^i)&(s^n)&128?8:0,r|=r>>2&1^r>>3&1?16:0,r|=i>s?1:0,r|=1&(~s&i|i&n|n&~s)?32:0,t.data[95]=r}else if((e&61440)===20480){const s=t.data[((e&240)>>4)+16],i=e&15|(e&3840)>>4,n=s-i;t.data[((e&240)>>4)+16]=n;let r=t.data[95]&192;r|=n?0:2,r|=128&n?4:0,r|=(s^i)&(s^n)&128?8:0,r|=r>>2&1^r>>3&1?16:0,r|=i>s?1:0,r|=1&(~s&i|i&n|n&~s)?32:0,t.data[95]=r}else if((e&65039)===37890){const s=(e&496)>>4,i=t.data[s];t.data[s]=(15&i)<<4|(240&i)>>>4}else if(e===38312)t.onWatchdogReset();else if((e&65039)===37380){const s=(e&496)>>4,i=t.data[s],n=t.data[t.dataView.getUint16(30,!0)];t.data[t.dataView.getUint16(30,!0)]=i,t.data[s]=n}}}}}t.pc=(t.pc+1)%t.progMem.length,t.cycles++}var it;(function(t){t[t.AVCC=0]="AVCC",t[t.AREF=1]="AREF",t[t.Internal1V1=2]="Internal1V1",t[t.Internal2V56=3]="Internal2V56",t[t.Reserved=4]="Reserved"})(it||(it={}));var S;(function(t){t[t.SingleEnded=0]="SingleEnded",t[t.Differential=1]="Differential",t[t.Constant=2]="Constant",t[t.Temperature=3]="Temperature"})(S||(S={}));const ki={0:{type:S.SingleEnded,channel:0},1:{type:S.SingleEnded,channel:1},2:{type:S.SingleEnded,channel:2},3:{type:S.SingleEnded,channel:3},4:{type:S.SingleEnded,channel:4},5:{type:S.SingleEnded,channel:5},6:{type:S.SingleEnded,channel:6},7:{type:S.SingleEnded,channel:7},8:{type:S.Temperature},14:{type:S.Constant,voltage:1.1},15:{type:S.Constant,voltage:0}};S.Constant;it.AREF,it.AVCC,it.Reserved,it.Internal1V1;const Oi={EICR:105,EIMSK:61,EIFR:60,index:0,iscOffset:0,interrupt:2},Vi={EICR:105,EIMSK:61,EIFR:60,index:1,iscOffset:2,interrupt:4},Fi={PCIE:0,PCICR:104,PCIFR:59,PCMSK:107,pinChangeInterrupt:6,mask:255,offset:0},Mi={PCIE:2,PCICR:104,PCIFR:59,PCMSK:109,pinChangeInterrupt:10,mask:255,offset:0},jt={PIN:35,DDR:36,PORT:37,pinChange:Fi,externalInterrupts:[]},gt={PIN:41,DDR:42,PORT:43,pinChange:Mi,externalInterrupts:[null,null,Oi,Vi]};var be;(function(t){t[t.Low=0]="Low",t[t.High=1]="High",t[t.Input=2]="Input",t[t.InputPullUp=3]="InputPullUp"})(be||(be={}));var p;(function(t){t[t.None=0]="None",t[t.Enable=1]="Enable",t[t.Set=2]="Set",t[t.Clear=3]="Clear",t[t.Toggle=4]="Toggle"})(p||(p={}));var Ae;(function(t){t[t.LowLevel=0]="LowLevel",t[t.Change=1]="Change",t[t.FallingEdge=2]="FallingEdge",t[t.RisingEdge=3]="RisingEdge"})(Ae||(Ae={}));const Di=128,Ni=64,Hi=32,Li=16,qi=8,Wi=4,zi=2,Xi=1,Ki=zi|Xi,Gi=128,ke=64,Yi=1,Zi={spiInterrupt:34,SPCR:76,SPSR:77,SPDR:78},ji=8;class $i{constructor(e,s,i){this.cpu=e,this.config=s,this.freqHz=i,this.onTransfer=()=>0,this.onByte=o=>{const d=this.onTransfer(o);this.cpu.addClockEvent(()=>this.completeTransfer(d),this.transferCycles)},this.transmissionActive=!1,this.SPI={address:this.config.spiInterrupt,flagRegister:this.config.SPSR,flagMask:Gi,enableRegister:this.config.SPCR,enableMask:Di};const{SPCR:n,SPSR:r,SPDR:a}=s;e.writeHooks[a]=o=>{if(e.data[n]&Ni)return this.transmissionActive?(e.data[r]|=ke,!0):(e.data[r]&=~ke,this.cpu.clearInterrupt(this.SPI),this.transmissionActive=!0,this.onByte(o),!0)},e.writeHooks[n]=o=>{this.cpu.updateInterruptEnable(this.SPI,o)},e.writeHooks[r]=o=>{this.cpu.data[r]=o,this.cpu.clearInterruptByFlag(this.SPI,o)}}reset(){this.transmissionActive=!1}completeTransfer(e){const{SPDR:s}=this.config;this.cpu.data[s]=e,this.cpu.setInterruptFlag(this.SPI),this.transmissionActive=!1}get isMaster(){return!!(this.cpu.data[this.config.SPCR]&Li)}get dataOrder(){return this.cpu.data[this.config.SPCR]&Hi?"lsbFirst":"msbFirst"}get spiMode(){const e=this.cpu.data[this.config.SPCR]&Wi,s=this.cpu.data[this.config.SPCR]&qi;return(e?2:0)|(s?1:0)}get clockDivider(){const e=this.cpu.data[this.config.SPSR]&Yi?2:4;switch(this.cpu.data[this.config.SPCR]&Ki){case 0:return e;case 1:return e*4;case 2:return e*16;case 3:return e*32}throw new Error("Invalid divider value!")}get transferCycles(){return this.clockDivider*ji}get spiFrequency(){return this.freqHz/this.clockDivider}}const ps={0:0,1:1,2:8,3:64,4:256,5:1024,6:0,7:0};var vt;(function(t){t[t.FallingEdge=6]="FallingEdge",t[t.RisingEdge=7]="RisingEdge"})(vt||(vt={}));const de={TOV:1,OCFA:2,OCFB:4,OCFC:0,TOIE:1,OCIEA:2,OCIEB:4,OCIEC:0},Ji=Object.assign({bits:8,captureInterrupt:0,compAInterrupt:28,compBInterrupt:30,compCInterrupt:0,ovfInterrupt:32,TIFR:53,OCRA:71,OCRB:72,OCRC:0,ICR:0,TCNT:70,TCCRA:68,TCCRB:69,TCCRC:0,TIMSK:110,dividers:ps,compPortA:gt.PORT,compPinA:6,compPortB:gt.PORT,compPinB:5,compPortC:0,compPinC:0,externalClockPort:gt.PORT,externalClockPin:4},de);Object.assign({bits:16,captureInterrupt:20,compAInterrupt:22,compBInterrupt:24,compCInterrupt:0,ovfInterrupt:26,TIFR:54,OCRA:136,OCRB:138,OCRC:0,ICR:134,TCNT:132,TCCRA:128,TCCRB:129,TCCRC:130,TIMSK:111,dividers:ps,compPortA:jt.PORT,compPinA:1,compPortB:jt.PORT,compPinB:2,compPortC:0,compPinC:0,externalClockPort:gt.PORT,externalClockPin:5},de);Object.assign({bits:8,captureInterrupt:0,compAInterrupt:14,compBInterrupt:16,compCInterrupt:0,ovfInterrupt:18,TIFR:55,OCRA:179,OCRB:180,OCRC:0,ICR:0,TCNT:178,TCCRA:176,TCCRB:177,TCCRC:0,TIMSK:112,dividers:{0:0,1:1,2:8,3:32,4:64,5:128,6:256,7:1024},compPortA:jt.PORT,compPinA:3,compPortB:gt.PORT,compPinB:3,compPortC:0,compPinC:0,externalClockPort:0,externalClockPin:0},de);var at;(function(t){t[t.Normal=0]="Normal",t[t.PWMPhaseCorrect=1]="PWMPhaseCorrect",t[t.CTC=2]="CTC",t[t.FastPWM=3]="FastPWM",t[t.PWMPhaseFrequencyCorrect=4]="PWMPhaseFrequencyCorrect",t[t.Reserved=5]="Reserved"})(at||(at={}));var R;(function(t){t[t.Max=0]="Max",t[t.Top=1]="Top",t[t.Bottom=2]="Bottom"})(R||(R={}));var C;(function(t){t[t.Immediate=0]="Immediate",t[t.Top=1]="Top",t[t.Bottom=2]="Bottom"})(C||(C={}));const L=1,nt=2,Z=1,{Normal:he,PWMPhaseCorrect:V,CTC:Dt,FastPWM:F,Reserved:$t,PWMPhaseFrequencyCorrect:mt}=at,Qi=[[he,255,C.Immediate,R.Max,0],[V,255,C.Top,R.Bottom,0],[Dt,L,C.Immediate,R.Max,0],[F,255,C.Bottom,R.Max,0],[$t,255,C.Immediate,R.Max,0],[V,L,C.Top,R.Bottom,Z],[$t,255,C.Immediate,R.Max,0],[F,L,C.Bottom,R.Top,Z]],tn=[[he,65535,C.Immediate,R.Max,0],[V,255,C.Top,R.Bottom,0],[V,511,C.Top,R.Bottom,0],[V,1023,C.Top,R.Bottom,0],[Dt,L,C.Immediate,R.Max,0],[F,255,C.Bottom,R.Top,0],[F,511,C.Bottom,R.Top,0],[F,1023,C.Bottom,R.Top,0],[mt,nt,C.Bottom,R.Bottom,0],[mt,L,C.Bottom,R.Bottom,Z],[V,nt,C.Top,R.Bottom,0],[V,L,C.Top,R.Bottom,Z],[Dt,nt,C.Immediate,R.Max,0],[$t,65535,C.Immediate,R.Max,0],[F,nt,C.Bottom,R.Top,Z],[F,L,C.Bottom,R.Top,Z]];function en(t){switch(t){case 1:return p.Toggle;case 2:return p.Clear;case 3:return p.Set;default:return p.Enable}}const Oe=128,Ve=64,sn=32;class nn{constructor(e,s){if(this.cpu=e,this.config=s,this.MAX=this.config.bits===16?65535:255,this.lastCycle=0,this.ocrA=0,this.nextOcrA=0,this.ocrB=0,this.nextOcrB=0,this.hasOCRC=this.config.OCRC>0,this.ocrC=0,this.nextOcrC=0,this.ocrUpdateMode=C.Immediate,this.tovUpdateMode=R.Max,this.icr=0,this.tcnt=0,this.tcntNext=0,this.tcntUpdated=!1,this.updateDivider=!1,this.countingUp=!0,this.divider=0,this.externalClockRisingEdge=!1,this.highByteTemp=0,this.OVF={address:this.config.ovfInterrupt,flagRegister:this.config.TIFR,flagMask:this.config.TOV,enableRegister:this.config.TIMSK,enableMask:this.config.TOIE},this.OCFA={address:this.config.compAInterrupt,flagRegister:this.config.TIFR,flagMask:this.config.OCFA,enableRegister:this.config.TIMSK,enableMask:this.config.OCIEA},this.OCFB={address:this.config.compBInterrupt,flagRegister:this.config.TIFR,flagMask:this.config.OCFB,enableRegister:this.config.TIMSK,enableMask:this.config.OCIEB},this.OCFC={address:this.config.compCInterrupt,flagRegister:this.config.TIFR,flagMask:this.config.OCFC,enableRegister:this.config.TIMSK,enableMask:this.config.OCIEC},this.count=(i=!0,n=!1)=>{const{divider:r,lastCycle:a,cpu:o}=this,{cycles:d}=o,l=d-a;if(r&&l>=r||n){const c=n?1:Math.floor(l/r);this.lastCycle+=c*r;const f=this.tcnt,{timerMode:h,TOP:x}=this,u=h===V||h===mt,m=u?this.phasePwmCount(f,c):(f+c)%(x+1),B=f+c>x;if(this.tcntUpdated||(this.tcnt=m,u||this.timerUpdated(m,f)),!u){if(h===F&&B){const{compA:U,compB:y}=this;U&&this.updateCompPin(U,"A",!0),y&&this.updateCompPin(y,"B",!0)}this.ocrUpdateMode==C.Bottom&&B&&(this.ocrA=this.nextOcrA,this.ocrB=this.nextOcrB,this.ocrC=this.nextOcrC),B&&(this.tovUpdateMode==R.Top||x===this.MAX)&&o.setInterruptFlag(this.OVF)}}if(this.tcntUpdated&&(this.tcnt=this.tcntNext,this.tcntUpdated=!1,(this.tcnt===0&&this.ocrUpdateMode===C.Bottom||this.tcnt===this.TOP&&this.ocrUpdateMode===C.Top)&&(this.ocrA=this.nextOcrA,this.ocrB=this.nextOcrB,this.ocrC=this.nextOcrC)),this.updateDivider){const{CS:c}=this,{externalClockPin:f}=this.config,h=this.config.dividers[c];this.lastCycle=h?this.cpu.cycles:0,this.updateDivider=!1,this.divider=h,this.config.externalClockPort&&!this.externalClockPort&&(this.externalClockPort=this.cpu.gpioByPort[this.config.externalClockPort]),this.externalClockPort&&(this.externalClockPort.externalClockListeners[f]=null),h?o.addClockEvent(this.count,this.lastCycle+h-o.cycles):this.externalClockPort&&(c===vt.FallingEdge||c===vt.RisingEdge)&&(this.externalClockPort.externalClockListeners[f]=this.externalClockCallback,this.externalClockRisingEdge=c===vt.RisingEdge);return}i&&r&&o.addClockEvent(this.count,this.lastCycle+r-o.cycles)},this.externalClockCallback=i=>{i===this.externalClockRisingEdge&&this.count(!1,!0)},this.updateWGMConfig(),this.cpu.readHooks[s.TCNT]=i=>(this.count(!1),this.config.bits===16&&(this.cpu.data[i+1]=this.tcnt>>8),this.cpu.data[i]=this.tcnt&255),this.cpu.writeHooks[s.TCNT]=i=>{this.tcntNext=this.highByteTemp<<8|i,this.countingUp=!0,this.tcntUpdated=!0,this.cpu.updateClockEvent(this.count,0),this.divider&&this.timerUpdated(this.tcntNext,this.tcntNext)},this.cpu.writeHooks[s.OCRA]=i=>{this.nextOcrA=this.highByteTemp<<8|i,this.ocrUpdateMode===C.Immediate&&(this.ocrA=this.nextOcrA)},this.cpu.writeHooks[s.OCRB]=i=>{this.nextOcrB=this.highByteTemp<<8|i,this.ocrUpdateMode===C.Immediate&&(this.ocrB=this.nextOcrB)},this.hasOCRC&&(this.cpu.writeHooks[s.OCRC]=i=>{this.nextOcrC=this.highByteTemp<<8|i,this.ocrUpdateMode===C.Immediate&&(this.ocrC=this.nextOcrC)}),this.config.bits===16){this.cpu.writeHooks[s.ICR]=r=>{this.icr=this.highByteTemp<<8|r};const i=r=>{this.highByteTemp=r},n=(r,a,o)=>(this.highByteTemp=r&this.ocrMask>>8,e.data[o]=this.highByteTemp,!0);this.cpu.writeHooks[s.TCNT+1]=i,this.cpu.writeHooks[s.OCRA+1]=n,this.cpu.writeHooks[s.OCRB+1]=n,this.hasOCRC&&(this.cpu.writeHooks[s.OCRC+1]=n),this.cpu.writeHooks[s.ICR+1]=i}e.writeHooks[s.TCCRA]=i=>(this.cpu.data[s.TCCRA]=i,this.updateWGMConfig(),!0),e.writeHooks[s.TCCRB]=i=>(s.TCCRC||(this.checkForceCompare(i),i&=~(Oe|Ve)),this.cpu.data[s.TCCRB]=i,this.updateDivider=!0,this.cpu.clearClockEvent(this.count),this.cpu.addClockEvent(this.count,0),this.updateWGMConfig(),!0),s.TCCRC&&(e.writeHooks[s.TCCRC]=i=>{this.checkForceCompare(i)}),e.writeHooks[s.TIFR]=i=>(this.cpu.data[s.TIFR]=i,this.cpu.clearInterruptByFlag(this.OVF,i),this.cpu.clearInterruptByFlag(this.OCFA,i),this.cpu.clearInterruptByFlag(this.OCFB,i),!0),e.writeHooks[s.TIMSK]=i=>{this.cpu.updateInterruptEnable(this.OVF,i),this.cpu.updateInterruptEnable(this.OCFA,i),this.cpu.updateInterruptEnable(this.OCFB,i)}}reset(){this.divider=0,this.lastCycle=0,this.ocrA=0,this.nextOcrA=0,this.ocrB=0,this.nextOcrB=0,this.ocrC=0,this.nextOcrC=0,this.icr=0,this.tcnt=0,this.tcntNext=0,this.tcntUpdated=!1,this.countingUp=!1,this.updateDivider=!0}get TCCRA(){return this.cpu.data[this.config.TCCRA]}get TCCRB(){return this.cpu.data[this.config.TCCRB]}get TIMSK(){return this.cpu.data[this.config.TIMSK]}get CS(){return this.TCCRB&7}get WGM(){const e=this.config.bits===16?24:8;return(this.TCCRB&e)>>1|this.TCCRA&3}get TOP(){switch(this.topValue){case L:return this.ocrA;case nt:return this.icr;default:return this.topValue}}get ocrMask(){switch(this.topValue){case L:case nt:return 65535;default:return this.topValue}}get debugTCNT(){return this.tcnt}updateWGMConfig(){const{config:e,WGM:s}=this,i=e.bits===16?tn:Qi,n=this.cpu.data[e.TCCRA],[r,a,o,d,l]=i[s];this.timerMode=r,this.topValue=a,this.ocrUpdateMode=o,this.tovUpdateMode=d;const c=r===F||r===V||r===mt,f=this.compA;this.compA=n>>6&3,this.compA===1&&c&&!(l&Z)&&(this.compA=0),!!f!=!!this.compA&&this.updateCompA(this.compA?p.Enable:p.None);const h=this.compB;if(this.compB=n>>4&3,this.compB===1&&c&&(this.compB=0),!!h!=!!this.compB&&this.updateCompB(this.compB?p.Enable:p.None),this.hasOCRC){const x=this.compC;this.compC=n>>2&3,this.compC===1&&c&&(this.compC=0),!!x!=!!this.compC&&this.updateCompC(this.compC?p.Enable:p.None)}}phasePwmCount(e,s){const{ocrA:i,ocrB:n,ocrC:r,hasOCRC:a,TOP:o,MAX:d,tcntUpdated:l}=this;for(!e&&!o&&(s=0,this.ocrUpdateMode===C.Top&&(this.ocrA=this.nextOcrA,this.ocrB=this.nextOcrB,this.ocrC=this.nextOcrC));s>0;)this.countingUp?(e++,e===o&&!l&&(this.countingUp=!1,this.ocrUpdateMode===C.Top&&(this.ocrA=this.nextOcrA,this.ocrB=this.nextOcrB,this.ocrC=this.nextOcrC))):(e--,!e&&!l&&(this.countingUp=!0,this.cpu.setInterruptFlag(this.OVF),this.ocrUpdateMode===C.Bottom&&(this.ocrA=this.nextOcrA,this.ocrB=this.nextOcrB,this.ocrC=this.nextOcrC))),l||(e===i&&(this.cpu.setInterruptFlag(this.OCFA),this.compA&&this.updateCompPin(this.compA,"A")),e===n&&(this.cpu.setInterruptFlag(this.OCFB),this.compB&&this.updateCompPin(this.compB,"B")),a&&e===r&&(this.cpu.setInterruptFlag(this.OCFC),this.compC&&this.updateCompPin(this.compC,"C"))),s--;return e&d}timerUpdated(e,s){const{ocrA:i,ocrB:n,ocrC:r,hasOCRC:a}=this,o=s>e;((s<i||o)&&e>=i||s<i&&o)&&(this.cpu.setInterruptFlag(this.OCFA),this.compA&&this.updateCompPin(this.compA,"A")),((s<n||o)&&e>=n||s<n&&o)&&(this.cpu.setInterruptFlag(this.OCFB),this.compB&&this.updateCompPin(this.compB,"B")),a&&((s<r||o)&&e>=r||s<r&&o)&&(this.cpu.setInterruptFlag(this.OCFC),this.compC&&this.updateCompPin(this.compC,"C"))}checkForceCompare(e){this.timerMode==at.FastPWM||this.timerMode==at.PWMPhaseCorrect||this.timerMode==at.PWMPhaseFrequencyCorrect||(e&Oe&&this.updateCompPin(this.compA,"A"),e&Ve&&this.updateCompPin(this.compB,"B"),this.config.compPortC&&e&sn&&this.updateCompPin(this.compC,"C"))}updateCompPin(e,s,i=!1){let n=p.None;const r=e===3,a=this.countingUp===r;switch(this.timerMode){case he:case Dt:n=en(e);break;case F:e===1?n=i?p.None:p.Toggle:n=r!==i?p.Set:p.Clear;break;case V:case mt:e===1?n=p.Toggle:n=a?p.Set:p.Clear;break}n!==p.None&&(s==="A"?this.updateCompA(n):s==="B"?this.updateCompB(n):this.updateCompC(n))}updateCompA(e){const{compPortA:s,compPinA:i}=this.config,n=this.cpu.gpioByPort[s];n==null||n.timerOverridePin(i,e)}updateCompB(e){const{compPortB:s,compPinB:i}=this.config,n=this.cpu.gpioByPort[s];n==null||n.timerOverridePin(i,e)}updateCompC(e){const{compPortC:s,compPinC:i}=this.config,n=this.cpu.gpioByPort[s];n==null||n.timerOverridePin(i,e)}}const rn={rxCompleteInterrupt:36,dataRegisterEmptyInterrupt:38,txCompleteInterrupt:40,UCSRA:192,UCSRB:193,UCSRC:194,UBRRL:196,UBRRH:197,UDR:198},an=128,on=64,Fe=32,Jt=2,fn=1,Me=Jt,ln=128,cn=64,dn=32,kt=16,Ot=8,Bs=4,De=Bs|kt|Ot,hn=32,xn=16,un=8,Ne=4,He=2,Cn={5:31,6:63,7:127,8:255,9:255};class gn{constructor(e,s,i){this.cpu=e,this.config=s,this.freqHz=i,this.onByteTransmit=null,this.onLineTransmit=null,this.onRxComplete=null,this.onConfigurationChange=null,this.rxBusyValue=!1,this.rxByte=0,this.lineBuffer="",this.RXC={address:this.config.rxCompleteInterrupt,flagRegister:this.config.UCSRA,flagMask:an,enableRegister:this.config.UCSRB,enableMask:ln,constant:!0},this.UDRE={address:this.config.dataRegisterEmptyInterrupt,flagRegister:this.config.UCSRA,flagMask:Fe,enableRegister:this.config.UCSRB,enableMask:dn},this.TXC={address:this.config.txCompleteInterrupt,flagRegister:this.config.UCSRA,flagMask:on,enableRegister:this.config.UCSRB,enableMask:cn},this.reset(),this.cpu.writeHooks[s.UCSRA]=(n,r)=>{var a;return e.data[s.UCSRA]=n&(fn|Jt),e.clearInterruptByFlag(this.TXC,n),(n&Me)!==(r&Me)&&((a=this.onConfigurationChange)===null||a===void 0||a.call(this)),!0},this.cpu.writeHooks[s.UCSRB]=(n,r)=>{var a;return e.updateInterruptEnable(this.RXC,n),e.updateInterruptEnable(this.UDRE,n),e.updateInterruptEnable(this.TXC,n),n&kt&&r&kt&&e.clearInterrupt(this.RXC),n&Ot&&!(r&Ot)&&e.setInterruptFlag(this.UDRE),e.data[s.UCSRB]=n,(n&De)!==(r&De)&&((a=this.onConfigurationChange)===null||a===void 0||a.call(this)),!0},this.cpu.writeHooks[s.UCSRC]=n=>{var r;return e.data[s.UCSRC]=n,(r=this.onConfigurationChange)===null||r===void 0||r.call(this),!0},this.cpu.readHooks[s.UDR]=()=>{var n;const r=(n=Cn[this.bitsPerChar])!==null&&n!==void 0?n:255,a=this.rxByte&r;return this.rxByte=0,this.cpu.clearInterrupt(this.RXC),a},this.cpu.writeHooks[s.UDR]=n=>{if(this.onByteTransmit&&this.onByteTransmit(n),this.onLineTransmit){const r=String.fromCharCode(n);r===`
`?(this.onLineTransmit(this.lineBuffer),this.lineBuffer=""):this.lineBuffer+=r}this.cpu.addClockEvent(()=>{e.setInterruptFlag(this.UDRE),e.setInterruptFlag(this.TXC)},this.cyclesPerChar),this.cpu.clearInterrupt(this.TXC),this.cpu.clearInterrupt(this.UDRE)},this.cpu.writeHooks[s.UBRRH]=n=>{var r;return this.cpu.data[s.UBRRH]=n,(r=this.onConfigurationChange)===null||r===void 0||r.call(this),!0},this.cpu.writeHooks[s.UBRRL]=n=>{var r;return this.cpu.data[s.UBRRL]=n,(r=this.onConfigurationChange)===null||r===void 0||r.call(this),!0}}reset(){this.cpu.data[this.config.UCSRA]=Fe,this.cpu.data[this.config.UCSRB]=0,this.cpu.data[this.config.UCSRC]=Ne|He,this.rxBusyValue=!1,this.rxByte=0,this.lineBuffer=""}get rxBusy(){return this.rxBusyValue}writeByte(e,s=!1){var i;const{cpu:n}=this;if(this.rxBusyValue||!this.rxEnable)return!1;if(s)this.rxByte=e,n.setInterruptFlag(this.RXC),(i=this.onRxComplete)===null||i===void 0||i.call(this);else return this.rxBusyValue=!0,n.addClockEvent(()=>{this.rxBusyValue=!1,this.writeByte(e,!0)},this.cyclesPerChar),!0}get cyclesPerChar(){const e=1+this.bitsPerChar+this.stopBits+(this.parityEnabled?1:0);return(this.UBRR+1)*this.multiplier*e}get UBRR(){const{UBRRH:e,UBRRL:s}=this.config;return this.cpu.data[e]<<8|this.cpu.data[s]}get multiplier(){return this.cpu.data[this.config.UCSRA]&Jt?8:16}get rxEnable(){return!!(this.cpu.data[this.config.UCSRB]&kt)}get txEnable(){return!!(this.cpu.data[this.config.UCSRB]&Ot)}get baudRate(){return Math.floor(this.freqHz/(this.multiplier*(1+this.UBRR)))}get bitsPerChar(){switch((this.cpu.data[this.config.UCSRC]&(Ne|He))>>1|this.cpu.data[this.config.UCSRB]&Bs){case 0:return 5;case 1:return 6;case 2:return 7;case 3:return 8;default:case 7:return 9}}get stopBits(){return this.cpu.data[this.config.UCSRC]&un?2:1}get parityEnabled(){return!!(this.cpu.data[this.config.UCSRC]&hn)}get parityOdd(){return!!(this.cpu.data[this.config.UCSRC]&xn)}}class vn{constructor(e){b(this,"cpu");b(this,"timer");b(this,"usart");b(this,"spi");b(this,"frequency",16e6);b(this,"serialBuffer",[]);b(this,"stopped",!1);this.cpu=new bi(e),this.timer=new nn(this.cpu,Ji),this.usart=new gn(this.cpu,rn,this.frequency),this.spi=new $i(this.cpu,Zi,this.frequency),this.usart.onRxComplete=()=>{this.serialBuffer.length>0&&this.usart.writeByte(this.serialBuffer.shift())}}serialWrite(e){for(let s of e)this.serialBuffer.push(s.charCodeAt(0));this.usart.rxBusy||this.usart.onRxComplete()}execute(e){if(this.stopped)return;const{cpu:s}=this,i=s.cycles+this.frequency/60;for(;s.cycles<=i;)Ai(s),s.tick();e(this.cpu),requestAnimationFrame(()=>this.execute(e))}stop(){this.stopped=!0}}const tt=[];function mn(t,e){return{subscribe:Is(t,e).subscribe}}function Is(t,e=X){let s=null;const i=new Set;function n(o){if(Ge(t,o)&&(t=o,s)){const d=!tt.length;for(const l of i)l[1](),tt.push(l,t);if(d){for(let l=0;l<tt.length;l+=2)tt[l][0](tt[l+1]);tt.length=0}}}function r(o){n(o(t))}function a(o,d=X){const l=[o,d];return i.add(l),i.size===1&&(s=e(n,r)||X),o(t),()=>{i.delete(l),i.size===0&&s&&(s(),s=null)}}return{set:n,update:r,subscribe:a}}function _n(t,e,s){const i=!Array.isArray(t),n=i?[t]:t;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=e.length<2;return mn(s,(a,o)=>{let d=!1;const l=[];let c=0,f=X;const h=()=>{if(c)return;f();const u=e(i?l[0]:l,a,o);r?a(u):f=typeof u=="function"?u:X},x=n.map((u,m)=>ys(u,B=>{l[m]=B,c&=~(1<<m),d&&h()},()=>{c|=1<<m}));return d=!0,h(),function(){qe(x),f(),d=!1}})}class Rn{constructor(){b(this,"TOTAL_MODULES",54);b(this,"ZONES",[54,30,20,10,0]);b(this,"display",0);b(this,"opcode",null);b(this,"store");this.store=Is(Array.from({length:this.TOTAL_MODULES},()=>new Uint8Array(8)))}subscribe(e,s){return this.store.subscribe(e,s)}set(e){this.opcode===null?this.opcode=e:(this.opcode<=8&&this.store.update(s=>(s[this.display][this.opcode-1]=e,s)),this.display=(this.display+1)%this.TOTAL_MODULES,this.opcode=null)}zone(e){return _n(this.store,s=>s.slice(this.ZONES[e+1],this.ZONES[e]))}}const ut=new Rn;var wn=ws("<ellipse></ellipse>"),yn=ws('<svg xmlns="http://www.w3.org/2000/svg"></svg>');function St(t,e){const s=Ui(),i=()=>Ii(e.modules,"$modules",s),n="#444444";var r=Ie(),a=ye(r);At(a,1,i,bt,(o,d)=>{var l=yn();At(l,21,()=>E(d),bt,(c,f,h)=>{var x=Ie(),u=ye(x);At(u,16,()=>Array(8),bt,(m,B,U)=>{var y=wn();Ft(()=>{Y(y,"fill",E(f)>>U&1?e.color:n),Y(y,"rx",e.ledWidth/2),Y(y,"ry",e.ledHeight/2),Y(y,"cx",e.ledWidth*(U+.5)),Y(y,"cy",e.ledHeight*(h+.5))}),st(m,y)}),st(c,x)}),Ft(()=>{Y(l,"width",e.ledWidth*8),Y(l,"height",e.ledHeight*8)}),st(o,l)}),st(t,r)}var pn=(t,e,s)=>e(s()),Bn=Rs('<button type="button"> </button>'),In=Rs('<main><!> <!> <!> <!> <div></div> <div class="outputs svelte-sofkya"><pre class="svelte-sofkya"> </pre></div></main>');function Un(t,e){gs(e,!0);const s=[["Alert: Follow",["AF0","TestFollow"]],["Alert: Sub",["AS0","TestSub","Nw sb mssg"]],["Alert: Resub",["As12","TestResub","Rsb mssg"]],["Alert: Gift",["AG10","TestGiftSub"]],["Alert: Cheer",["AC1000","TestCheer","Chr mssg"]],["Alert: Raid",["AR10000","TestRaid","Rd Tst"]],["Label: Follow",["LF0","TestFollow"]],["Label: Sub",["LS0","TestSub"]],["Label: Resub",["Ls24","TestResub"]],["Label: Cheer",["LC1000","TestCheer"]]];let i,n=Re(""),r=Re(void 0);fetch("./firmware.bin").then(async _=>{const H=await _.arrayBuffer();return i=new vn(new Uint16Array(H)),i.spi.onByte=k=>{ut.set(k),i.spi.completeTransfer(k)},i.usart.onLineTransmit=k=>{Pt(n,E(n)+`${k}
`)},i.execute(()=>{}),()=>{i.stop()}});function a(_){for(const H of _)Pt(n,E(n)+`>> ${H}
`),i.serialWrite(`${H}
`)}Qs(()=>{E(n)&&E(r).scroll({top:E(r).scrollHeight,behavior:"smooth"})});var o=In(),d=Ut(o),l=Et(()=>ut.zone(0));St(d,{color:"#ff9900",ledWidth:4,ledHeight:5,get modules(){return E(l)}});var c=ht(d,2),f=Et(()=>ut.zone(1));St(c,{color:"#ff9900",ledWidth:4,ledHeight:5,get modules(){return E(f)}});var h=ht(c,2),x=Et(()=>ut.zone(2));St(h,{color:"#ff9900",ledWidth:4,ledHeight:5,get modules(){return E(x)}});var u=ht(h,2),m=Et(()=>ut.zone(3));St(u,{color:"#ff9900",ledWidth:4,ledHeight:5,get modules(){return E(m)}});var B=ht(u,2);At(B,21,()=>s,bt,(_,H)=>{let k=()=>E(H)[0],O=()=>E(H)[1];var J=Bn();J.__click=[pn,a,O];var ct=Ut(J);Ft(()=>Ue(ct,k())),st(_,J)});var U=ht(B,2),y=Ut(U);Bi(y,_=>Pt(r,_),()=>E(r));var g=Ut(y);Ft(()=>Ue(g,E(n))),st(t,o),vs()}ui(["click"]);vi(Un,{target:document.getElementById("app")});
